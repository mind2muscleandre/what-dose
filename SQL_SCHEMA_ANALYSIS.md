# SQL Schema Analysis - WhatDose App

## ‚úÖ Vad SQL-schemat T√ÑCKER:

### 1. **Profiles** ‚úÖ
- Anv√§ndarprofiler med `goal_profile`, `experience_level`, `onboarding_completed`
- Kopplat till Supabase Auth

### 2. **Supplements Library** ‚úÖ
- Master-databas med alla tillskott
- Research status, regulatory status, dosing info
- Category mapping
- Seed data inkluderad

### 3. **User Stacks** ‚úÖ
- Anv√§ndarens personliga stack
- Custom dosering per tillskott
- Schedule blocks (Morning, Lunch, etc.)
- Unikt constraint f√∂r att f√∂rhindra dubletter

### 4. **Daily Logs** ‚úÖ
- Tracking av individuella doser
- Status (taken/skipped)
- Datum-baserad loggning

### 5. **Daily Checkins** ‚úÖ
- Sleep score
- Energy tags
- Side effects
- Notes

---

## ‚ùå Vad som SAKNAS:

### 1. **Community Features** ‚ùå
**Sidan:** `components/whatdose/community.tsx`

**Saknas:**
- Tabell f√∂r delade community stacks
- Likes p√• stacks
- Comments p√• stacks

**Beh√∂ver:**
```sql
CREATE TABLE community_stacks (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id UUID REFERENCES profiles(id) ON DELETE CASCADE NOT NULL,
    title TEXT NOT NULL,
    description TEXT,
    supplements JSONB, -- Array av {name, dosage}
    likes_count INT DEFAULT 0,
    comments_count INT DEFAULT 0,
    is_public BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW())
);

CREATE TABLE stack_likes (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    stack_id BIGINT REFERENCES community_stacks(id) ON DELETE CASCADE NOT NULL,
    user_id UUID REFERENCES profiles(id) ON DELETE CASCADE NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW()),
    UNIQUE(stack_id, user_id)
);

CREATE TABLE stack_comments (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    stack_id BIGINT REFERENCES community_stacks(id) ON DELETE CASCADE NOT NULL,
    user_id UUID REFERENCES profiles(id) ON DELETE CASCADE NOT NULL,
    content TEXT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW())
);
```

---

### 2. **Timeline Blocks / Task Tracking** ‚ùå
**Sidan:** `components/whatdose/dashboard.tsx` + `lib/whatdose-data.ts`

**Saknas:**
- Tabell f√∂r timeline blocks (Morning, Pre-Workout, Bedtime, etc.)
- Task items inom varje block
- Completion tracking per dag

**Beh√∂ver:**
```sql
CREATE TABLE timeline_blocks (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id UUID REFERENCES profiles(id) ON DELETE CASCADE NOT NULL,
    block_id TEXT NOT NULL, -- 'morning_routine', 'pre_workout', etc.
    title TEXT NOT NULL,
    subtitle TEXT,
    suggested_time TIME,
    ui_color_hex TEXT,
    icon_key TEXT,
    display_order INT,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW()),
    UNIQUE(user_id, block_id)
);

CREATE TABLE timeline_items (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    block_id BIGINT REFERENCES timeline_blocks(id) ON DELETE CASCADE NOT NULL,
    stack_item_id BIGINT REFERENCES user_stacks(id) ON DELETE CASCADE,
    item_id TEXT NOT NULL,
    display_order INT,
    notes TEXT,
    critical_instruction TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW())
);

CREATE TABLE daily_task_completions (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id UUID REFERENCES profiles(id) ON DELETE CASCADE NOT NULL,
    item_id TEXT NOT NULL, -- References timeline_items.item_id
    completion_date DATE DEFAULT CURRENT_DATE,
    is_completed BOOLEAN DEFAULT FALSE,
    completed_at TIMESTAMP WITH TIME ZONE,
    UNIQUE(user_id, item_id, completion_date)
);
```

---

### 3. **Progress Metrics** ‚ùå
**Sidan:** `components/whatdose/dashboard.tsx`

**Saknas:**
- Streak days tracking
- Compliance percentage calculation
- Total/completed tasks per dag

**Beh√∂ver:**
```sql
-- Kan ber√§knas fr√•n daily_task_completions, men kan ocks√• cacha:
CREATE TABLE user_progress_metrics (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id UUID REFERENCES profiles(id) ON DELETE CASCADE NOT NULL,
    metric_date DATE DEFAULT CURRENT_DATE,
    streak_days INT DEFAULT 0,
    total_tasks INT DEFAULT 0,
    completed_tasks INT DEFAULT 0,
    compliance_percentage NUMERIC(5,2) DEFAULT 0,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW()),
    UNIQUE(user_id, metric_date)
);
```

---

### 4. **Profile - Biometrics** ‚ùå
**Sidan:** `components/whatdose/onboarding.tsx` + `components/whatdose/profile.tsx`

**Saknas:**
- Age, weight, gender i profiles tabellen

**Beh√∂ver:**
```sql
ALTER TABLE profiles ADD COLUMN age INT;
ALTER TABLE profiles ADD COLUMN weight_kg NUMERIC(5,2);
ALTER TABLE profiles ADD COLUMN gender TEXT; -- 'male', 'female', 'other'
```

---

### 5. **Onboarding - Selected Goals** ‚ùå
**Sidan:** `components/whatdose/onboarding.tsx`

**Saknas:**
- Selected goals som array (nu √§r det bara `goal_profile` som TEXT)

**Beh√∂ver:**
```sql
-- Alternativ 1: Anv√§nd array i profiles
ALTER TABLE profiles ADD COLUMN selected_goals TEXT[];

-- Alternativ 2: Separata tabell f√∂r b√§ttre normalisering
CREATE TABLE user_goals (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id UUID REFERENCES profiles(id) ON DELETE CASCADE NOT NULL,
    goal_id TEXT NOT NULL, -- 'muscle', 'sleep', 'focus', etc.
    created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW()),
    UNIQUE(user_id, goal_id)
);
```

---

### 6. **Profile Stats** ‚ùå
**Sidan:** `components/whatdose/profile.tsx`

**Saknas:**
- Days streak (visas i profile)
- Total supplements count
- Compliance percentage

**Beh√∂ver:**
- Kan ber√§knas fr√•n befintliga tabeller, men kan ocks√• cacha i `user_progress_metrics`

---

## üìä Sammanfattning:

### T√§cker:
- ‚úÖ Core supplement management (library, stacks, logs)
- ‚úÖ Daily check-ins
- ‚úÖ User profiles (grundl√§ggande)

### Saknas:
- ‚ùå Community features (stacks, likes, comments)
- ‚ùå Timeline blocks & task tracking
- ‚ùå Progress metrics (streak, compliance)
- ‚ùå Biometrics (age, weight, gender)
- ‚ùå Selected goals (array)
- ‚ùå Profile stats caching

---

## üéØ Rekommendation:

SQL-schemat t√§cker **grundfunktionerna** men saknar:
1. **Community-funktionalitet** (viktig f√∂r social features)
2. **Task/timeline tracking** (viktig f√∂r dashboard)
3. **Progress metrics** (viktig f√∂r gamification)
4. **Biometrics** (anv√§nds i onboarding)

F√∂r en komplett app beh√∂ver du l√§gga till dessa tabeller.

